# Error Resolution Guide

This document addresses common errors and their solutions.

## 1. ‚õî 403 Forbidden - Notification Creation

**Error:** `POST /api/notifications/create 403 (Forbidden) - "This feature requires a premium plan"`

**What's happening:** The `/api/notifications/create` endpoint requires the `priority_support` feature, which is only available on premium plans (Professional/Enterprise).

**Solution:** 
- ‚úÖ **Fixed:** The notification service now checks user plan before calling the backend endpoint
- If you're on Starter plan, notifications will silently fail (no error shown to user)
- To enable notifications, upgrade to Professional or Enterprise plan

**Status:** ‚úÖ Fixed in `notificationService.js` - plan check added before backend call

---

## 2. ‚ö†Ô∏è Firebase Authentication Errors (401/400)

**Errors:**
- `signInWithCustomToken ... 401 (Unauthorized)`
- `Create Installation request failed ... 400 INVALID_ARGUMENT`

**What's happening:** 
- **401:** The Firebase custom token generated by the backend is invalid, expired, or signed with wrong credentials
- **400:** Firebase API key restrictions may be blocking localhost, or configuration is missing required fields

**Solutions:**

### Check Firebase Service Account
1. Verify `FIREBASE_SERVICE_ACCOUNT_PATH` in backend `.env` points to valid service account JSON
2. Ensure service account has "Firebase Admin SDK Administrator Service Agent" role
3. Verify the service account project matches your frontend Firebase config

### Check Firebase API Key Restrictions
1. Go to [Google Cloud Console > APIs & Services > Credentials](https://console.cloud.google.com/apis/credentials)
2. Find your Firebase Web API Key
3. Check "Application restrictions":
   - For development: Add `http://localhost:3000` and `http://127.0.0.1:3000` to HTTP referrer restrictions
   - For production: Add your production domain
4. Check "API restrictions": Ensure "Firebase Installations API" and "Firebase Cloud Messaging API" are enabled

### Verify Frontend Firebase Config
1. Check `rpa-system/rpa-dashboard/src/utils/firebaseConfig.js`
2. Ensure `apiKey`, `authDomain`, `projectId` match your Firebase project
3. Verify `messagingSenderId` and `appId` are correct

**Status:** ‚ö†Ô∏è Requires manual configuration verification

---

## 3. üê¢ Slow API Responses - /api/runs (5-10 seconds)

**Error:** `[HistoryPage] Slow API response detected {duration_ms: 10088}`

**What's happening:** The `/api/runs` endpoint is performing full table scans without proper indexes.

**Solution:**
- ‚úÖ **Fixed:** Created migration `add_runs_performance_index.sql` with critical indexes
- Run the migration in your Supabase SQL editor:
  ```sql
  -- Run: rpa-system/backend/migrations/add_runs_performance_index.sql
  ```

**Required Indexes:**
```sql
CREATE INDEX IF NOT EXISTS idx_automation_runs_user_id_started_at 
ON automation_runs(user_id, started_at DESC);

CREATE INDEX IF NOT EXISTS idx_automation_runs_task_id 
ON automation_runs(task_id) 
WHERE task_id IS NOT NULL;
```

**Status:** ‚úÖ Migration created - **Run in Supabase SQL editor**

---

## 4. üîå Realtime & Analytics (Expected Behaviors)

### Realtime Disconnections
**Error:** `[realtime] Channel temporarily disconnected`

**What's happening:** Supabase Realtime connections drop due to:
- Network blips
- Browser tab backgrounded for extended periods
- Browser going to sleep

**Solution:** ‚úÖ **Expected behavior** - The client automatically schedules reconnection. No action needed.

### Google Analytics Blocked
**Error:** `[net] POST failed ... google-analytics.com ... status: 0`

**What's happening:** Ad blockers (uBlock Origin, Brave Shields, etc.) are blocking Google Analytics requests.

**Solution:** ‚úÖ **Expected behavior** - This is normal when ad blockers are active. Analytics will work for users without ad blockers.

**Status:** ‚úÖ Expected behaviors - No fixes needed

---

## Summary

| Issue | Status | Action Required |
|-------|--------|----------------|
| 403 Notification Creation | ‚úÖ Fixed | None - plan check added |
| Firebase Auth 401/400 | ‚ö†Ô∏è Manual | Verify Firebase config & API key restrictions |
| Slow /api/runs | ‚úÖ Migration Ready | Run `add_runs_performance_index.sql` in Supabase |
| Realtime Disconnections | ‚úÖ Expected | None - auto-reconnects |
| Analytics Blocked | ‚úÖ Expected | None - ad blocker behavior |

