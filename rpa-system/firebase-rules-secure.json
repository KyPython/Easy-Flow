{
  "rules": {
    ".read": false,
    ".write": false,
    
    "notifications": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
        ".write": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
        
        "$notificationId": {
          ".read": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
          ".write": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
          ".validate": "newData.hasChildren(['title', 'body', 'timestamp', 'read', 'type']) && newData.child('title').isString() && newData.child('body').isString() && newData.child('timestamp').isString() && newData.child('read').isBoolean() && newData.child('type').isString()"
        },
        
        ".indexOn": ["timestamp", "read", "type"]
      }
    },
    
    "health": {
      ".read": "auth != null",
      ".write": false
    },
    
    "presence": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
        ".write": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
        ".validate": "newData.hasChildren(['online', 'last_seen']) && newData.child('online').isBoolean() && newData.child('last_seen').isString()"
      }
    },
    
    "announcements": {
      ".read": "auth != null && auth.token.supabase_uid != null",
      ".write": false,
      
      "$announcementId": {
        ".validate": "newData.hasChildren(['title', 'message', 'timestamp', 'priority']) && newData.child('title').isString() && newData.child('message').isString() && newData.child('timestamp').isString() && newData.child('priority').isString()"
      }
    },
    
    "feature_flags": {
      ".read": "auth != null && auth.token.supabase_uid != null",
      ".write": false
    },
    
    "user_settings": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
        ".write": "auth != null && auth.uid == $userId && auth.token.supabase_uid == $userId",
        ".validate": "newData.hasChildren(['notification_preferences', 'updated_at']) && newData.child('notification_preferences').hasChildren() && newData.child('updated_at').isString()"
      }
    }
  }
}