# Service Worker Firebase Configuration Guide

## üî• CRITICAL: Service Worker Configuration

The Firebase service worker (`firebase-messaging-sw.js`) **cannot read `.env.local` files**. It needs a static configuration file at `/public/firebase-config.js`.

## Why This File Exists

Service workers run in a separate context and cannot access:
- Environment variables from `.env.local`
- `process.env` variables
- Runtime configuration

They can only access:
- Static files in the `public/` directory
- Files loaded via `importScripts()`

## File Location

```
/Users/ky/Easy-Flow/rpa-system/rpa-dashboard/public/firebase-config.js
```

**Note:** This file is git-ignored for security (contains API keys).

## How to Generate

### Option 1: Automatic Generation (Recommended)

Run the generation script:

```bash
cd rpa-system/rpa-dashboard
./generate_firebase_config.sh
```

This script:
1. Reads values from `.env.local`
2. Generates `public/firebase-config.js`
3. Validates required values are present

### Option 2: Manual Creation

Copy values from `.env.local` and create the file:

```javascript
// public/firebase-config.js
const FIREBASE_CONFIG = {
  apiKey: "your-api-key-from-env-local",
  authDomain: "easyflow-77db9.firebaseapp.com",
  databaseURL: "https://easyflow-77db9-default-rtdb.firebaseio.com",
  projectId: "easyflow-77db9",
  storageBucket: "easyflow-77db9.firebasestorage.app",
  messagingSenderId: "your-sender-id",
  appId: "your-app-id"
};
```

### Option 3: Use Build Script

The build process automatically generates this file:

```bash
npm run build
```

The `vercel-scripts/generate-firebase-config.js` script runs during build.

## Required Values

All values must match your `.env.local`:

| Config Field | .env.local Variable | Required |
|-------------|---------------------|----------|
| `apiKey` | `REACT_APP_FIREBASE_API_KEY` | ‚úÖ Yes |
| `authDomain` | `REACT_APP_FIREBASE_AUTH_DOMAIN` | ‚úÖ Yes |
| `databaseURL` | `REACT_APP_FIREBASE_DATABASE_URL` | ‚úÖ Yes |
| `projectId` | `REACT_APP_FIREBASE_PROJECT_ID` | ‚úÖ Yes |
| `storageBucket` | `REACT_APP_FIREBASE_STORAGE_BUCKET` | ‚úÖ Yes |
| `messagingSenderId` | `REACT_APP_FIREBASE_MESSAGING_SENDER_ID` | ‚úÖ Yes |
| `appId` | `REACT_APP_FIREBASE_APP_ID` | ‚úÖ Yes |

**CRITICAL:** `projectId` must be `easyflow-77db9` to match backend.

## Verification

After generating the file:

1. **Check file exists:**
   ```bash
   ls public/firebase-config.js
   ```

2. **Verify format:**
   ```bash
   cat public/firebase-config.js
   ```

3. **Check browser console:**
   - Should NOT see: `‚ùå CRITICAL: Could not load firebase-config.js`
   - Should see: `‚úÖ Firebase initialized successfully`

## When to Regenerate

Regenerate this file when:
- ‚úÖ You update `.env.local` Firebase values
- ‚úÖ You switch between environments (dev/prod)
- ‚úÖ You clone the repo to a new machine
- ‚úÖ After pulling changes that update `.env.example`

## Troubleshooting

### Error: "Could not load firebase-config.js"
- **Cause:** File doesn't exist or is in wrong location
- **Fix:** Run `./generate_firebase_config.sh`

### Error: "Missing App configuration value: projectId"
- **Cause:** File exists but has empty/invalid values
- **Fix:** Regenerate from `.env.local` using the script

### Error: "400 INVALID_ARGUMENT"
- **Cause:** Values in `firebase-config.js` don't match actual Firebase project
- **Fix:** Verify values match Firebase Console ‚Üí Project Settings

## File Format

The file must export a `FIREBASE_CONFIG` constant:

```javascript
const FIREBASE_CONFIG = {
  apiKey: "...",
  authDomain: "...",
  databaseURL: "...",
  projectId: "...",
  storageBucket: "...",
  messagingSenderId: "...",
  appId: "..."
};
```

**Note:** No `export` statement needed - service worker uses `importScripts()`.

## Security Note

‚ö†Ô∏è  **This file contains PUBLIC API keys** (not secrets):
- Firebase API keys are public by design
- They're restricted by domain in Firebase Console
- Still, this file is git-ignored to avoid exposing keys in repos

## Integration with Build Process

For production builds, the file is automatically generated by:
- `vercel-scripts/generate-firebase-config.js` (runs during build)
- Reads from Vercel environment variables
- Outputs to `public/firebase-config.js`

For local development:
- Run `./generate_firebase_config.sh` manually
- Or use `npm start` (which should trigger generation)
