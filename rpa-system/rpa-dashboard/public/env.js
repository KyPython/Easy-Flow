// Runtime environment configuration
// WARNING: Do not hardcode secrets in this file. Values should be provided at deploy time.
// This file enables runtime configuration via window._env without rebuilding the app.

// Runtime environment configuration
// This file is evaluated at runtime and should be generated by your deployment
// pipeline. To maintain backward compatibility with older deployments that
// still inject `REACT_APP_*` variables, we populate both `VITE_*` and
// `REACT_APP_*` variants onto `window._env` so the frontend works regardless
// of which naming convention was used at deploy time.

(function () {
  // Safe-read any existing runtime window._env (deployment may have replaced this file)
  const existing = window._env || {};

  const env = {
    // Primary keys (prefer VITE_ names)
    VITE_API_BASE: existing.VITE_API_BASE || existing.REACT_APP_API_BASE || '',
    VITE_PUBLIC_URL: existing.VITE_PUBLIC_URL || existing.REACT_APP_PUBLIC_URL || '',

    // Supabase configuration (client anon key)
    VITE_SUPABASE_URL: existing.VITE_SUPABASE_URL || existing.REACT_APP_SUPABASE_URL || '',
    VITE_SUPABASE_ANON_KEY: existing.VITE_SUPABASE_ANON_KEY || existing.REACT_APP_SUPABASE_ANON_KEY || '',

    // Firebase
    VITE_FIREBASE_API_KEY: existing.VITE_FIREBASE_API_KEY || existing.REACT_APP_FIREBASE_API_KEY || '',
    VITE_FIREBASE_AUTH_DOMAIN: existing.VITE_FIREBASE_AUTH_DOMAIN || existing.REACT_APP_FIREBASE_AUTH_DOMAIN || '',
    VITE_FIREBASE_DATABASE_URL: existing.VITE_FIREBASE_DATABASE_URL || existing.REACT_APP_FIREBASE_DATABASE_URL || '',
    VITE_FIREBASE_PROJECT_ID: existing.VITE_FIREBASE_PROJECT_ID || existing.REACT_APP_FIREBASE_PROJECT_ID || '',
    VITE_FIREBASE_STORAGE_BUCKET: existing.VITE_FIREBASE_STORAGE_BUCKET || existing.REACT_APP_FIREBASE_STORAGE_BUCKET || '',
    VITE_FIREBASE_MESSAGING_SENDER_ID: existing.VITE_FIREBASE_MESSAGING_SENDER_ID || existing.REACT_APP_FIREBASE_MESSAGING_SENDER_ID || '',
    VITE_FIREBASE_APP_ID: existing.VITE_FIREBASE_APP_ID || existing.REACT_APP_FIREBASE_APP_ID || '',
    VITE_FIREBASE_MEASUREMENT_ID: existing.VITE_FIREBASE_MEASUREMENT_ID || existing.REACT_APP_FIREBASE_MEASUREMENT_ID || '',
    VITE_FIREBASE_VAPID_KEY: existing.VITE_FIREBASE_VAPID_KEY || existing.REACT_APP_FIREBASE_VAPID_KEY || '',
    VITE_FIREBASE_FUNCTIONS_URL: existing.VITE_FIREBASE_FUNCTIONS_URL || existing.REACT_APP_FIREBASE_FUNCTIONS_URL || '',

    // Analytics and widgets
    VITE_GA_MEASUREMENT_ID: existing.VITE_GA_MEASUREMENT_ID || existing.REACT_APP_GA_MEASUREMENT_ID || '',
    VITE_UCHAT_WIDGET_ID: existing.VITE_UCHAT_WIDGET_ID || existing.REACT_APP_UCHAT_WIDGET_ID || '',

    ENABLE_ANALYTICS: existing.ENABLE_ANALYTICS || existing.REACT_APP_ENABLE_ANALYTICS || 'false'
  };

  // Mirror keys so code looking for REACT_APP_* also finds values.
  const mirror = {};
  Object.keys(env).forEach((k) => {
    if (k.startsWith('VITE_')) {
      const reactKey = k.replace(/^VITE_/, 'REACT_APP_');
      mirror[reactKey] = existing[reactKey] || env[k] || '';
    }
  });

  // Final window._env includes both sets (VITE_* preferred, REACT_APP_* mirrored)
  window._env = Object.assign({}, env, mirror, existing);
})();

