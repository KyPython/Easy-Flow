#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# EasyFlow Pre-Push Hook
# Runs different checks based on branch:
# - dev branch: Light checks only (allows saving work)
# - main branch: Full strict checks (production safety)

CURRENT_BRANCH=$(git branch --show-current)

if [ "$CURRENT_BRANCH" = "main" ]; then
    echo "üöÄ Running pre-push validation for PRODUCTION (main branch)..."
    echo "‚ö†Ô∏è  Strict checks required for production deployment"
    npm run test:all
elif [ "$CURRENT_BRANCH" = "dev" ]; then
    echo "üíæ Running light pre-push checks for dev branch (work-in-progress)..."
    echo "‚ÑπÔ∏è  Full checks will run when you ship to production (npm run ship)"
    # Only run quick checks, skip full test suite and security scan
    ./scripts/dev-env-check.sh >/dev/null 2>&1 || true
    echo "‚úÖ Dev branch push allowed (full checks skipped for faster workflow)"
else
    echo "‚ö†Ô∏è  Unknown branch: $CURRENT_BRANCH"
    echo "Running full checks to be safe..."
    npm run test:all
fi

